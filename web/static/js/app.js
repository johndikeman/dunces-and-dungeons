// Generated by CoffeeScript 1.10.0
(function() {
  var fix_this_pls, make_choice_form, process_old_messages;

  $(document).ready(function() {
    var source;
    process_old_messages(window.messages);
    source = new EventSource('/stream');
    return source.onmessage = function(event) {
      $('#main').append(event.data);
      if (event.data.slice(0, 6) === 'CHOICE') {
        console.log("CREATING A FORM");
        return make_choice_form(event);
      }
    };
  });

  make_choice_form = function(event) {
    var a, form, i, len, options;
    options = event.data.slice(6).split('|');
    form = "<form id=\"ch\" action=\"/choice\" method='post'>";
    for (i = 0, len = options.length; i < len; i++) {
      a = options[i];
      if (a !== '' && a !== void 0) {
        form += "<input type=\"radio\" name='makechoice' value=\"" + a[0] + "\">" + a.slice(1) + "<br>";
      }
    }
    form += "<input type=\"submit\" value=\"choose!\">";
    form += "</form>";
    return $('#main').append(form);
  };

  process_old_messages = function(message) {
    var i, len, mes, results;
    console.log("printing the options now! " + message);
    results = [];
    for (i = 0, len = message.length; i < len; i++) {
      mes = message[i];
      results.push($('#main').append(mes + "<br>"));
    }
    return results;
  };

  fix_this_pls = function() {
    return false;
  };

}).call(this);
